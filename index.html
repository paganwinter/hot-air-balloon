<html>
<head>
<title>Earth</title>
<style>
body {
  margin: 0;
}
.column {
  display: inline-block;
  position: absolute;
  width: 512px;
  /* border-left: 1px solid #000; */
}
.tile {
  width: 256px;
  height: 256px;
  padding: 0;
  margin: 0;
  display: inline-block;
  font-size: 32px;
  color: white;
}
</style>
</style>
</head>
<body>

<div id="main" style="_border: 1px solid #AAA; height: 512px; width: 512px; font-size: 0; overflow-x: hidden">
  <div class="column" id="column-1" style="background: red;">
  </div>
  <div class="column" id="column-2" style="background: blue;">
  </div>
</div>

<script>
function long2tile(lon, zoom) { return (Math.floor((lon + 180) / 360 * Math.pow(2, zoom))); }
function lat2tile(lat, zoom)  { return (Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom))); }
// https://tile.openstreetmap.org/7/63/42.png
/*
function start() {
  let start = Date.now(); // remember start time
  let timer = setInterval(function() {
    let timePassed = Date.now() - start;

    if (timePassed >= 2000) {
      clearInterval(timer); // finish the animation after 2 seconds
      return;
    }
    draw($c1, timePassed);
  }, 10);
}
// as timePassed goes from 0 to 2000
// left gets values from 0px to 400px
function draw(el, timePassed) {
  el.style.left = timePassed / 5 + 'px';
}
start()
*/

const FPS = 60
let frameWidth = 0
const screenWidth = document.body.clientWidth

function moveRight(el, distance, time, cb) {
  let frames = FPS * time
  const pixelsPerFrame = distance / frames
  const frameDelay = 1000 / FPS
  console.time('t')

  let startLeft = el.offsetLeft
  let timer = setInterval(function () {
    let distanceCovered = el.offsetLeft - startLeft
    // if (distanceCovered >= distance) {
    //   console.log(distanceCovered, distance, frameWidth)
    //   el.style.left = -frameWidth
    //   cb()
    // }
    if (el.offsetLeft >= frameWidth) {
      cb()
      el.style.left = -frameWidth
    }

    let newLeft = el.offsetLeft + pixelsPerFrame
    // console.log(newLeft)
    el.style.left = newLeft
  }, frameDelay)
  return timer
}

function addTiles(frame, noOfTiles, color) {
  for (let i = 0; i < noOfTiles; i++) {
    let $tile = document.createElement('div')
    $tile.classList.add('tile')
    // $tile.style.background = '#' + ((1<<24)*Math.random()|0).toString(16)
    $tile.style.backgroundColor = `rgba(${color}, ${1/i})`
    $tile.innerHTML = i
    frame.append($tile)
  }
}

window.onload = function () {
  let $main = document.getElementById('main')
  let $c1 = document.getElementById('column-1')
  let $c2 = document.getElementById('column-2')
  const tilesPerFrame = Math.ceil(screenWidth / 256)
  frameWidth = tilesPerFrame * 256
  $c1.style.width = frameWidth
  $c2.style.width = frameWidth
  $main.style.width = screenWidth
  addTiles($c1, tilesPerFrame * 2, '0,0,0')
  addTiles($c2, tilesPerFrame * 2,  '8,8,8')

  console.log('frameWidth', frameWidth)
  console.log('tilesPerFrame', tilesPerFrame)
  console.log('frameWidth', frameWidth)


  $c1.style.left = -frameWidth
  $c2.style.left = 0
  // let t1 = moveRight($c1, frameWidth * 2, 10, function () {})
  let t2 = moveRight($c2, frameWidth * 2, 10, function () {})
  // clearInterval(t2)
}

</script>

</body>
</html>
